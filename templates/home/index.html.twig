{% extends 'base.html.twig' %}

{% block title %}
  Tableau de bord
{% endblock %}
{% block widget_droite %}
   
{% endblock %}
{% block body %}


  <!-- Content Rodcdcdcdw -->
        <div class="row">
            <!-- Earnings (Monthly) Card Example -->
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card border-left-primary  h-100 py-2">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                    Achat effectuer</div>
                                <div class="h5 mb-0 font-weight-bold text-gray-800">
                                    {% if achats > 0 %}
                                        {{ achats }}
                                    {% else %}
                                        <p>Aucune achat </p>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-calendar fa-2x text-gray-300"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Earnings (Monthly) Card Example -->
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card border-left-success  h-100 py-2">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                    Vente effectuer</div>
                                <div class="h5 mb-0 font-weight-bold text-gray-800">
                                    {% if ventes > 0 %}
                                        {{ ventes }}
                                    {% else %}
                                        <p>Aucune vente </p>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-dollar-sign fa-2x text-gray-300"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Earnings (Monthly) Card Example -->
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card border-left-info  h-100 py-2">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-info text-uppercase mb-1">Produits
                                </div>
                                <div class="row no-gutters align-items-center">
                                    <div class="col-auto">
                                        <div class="h5 mb-0 mr-3 font-weight-bold text-gray-800">
                                            {% if produits > 0 %}
                                                {{ produits }}
                                            {% else %}
                                                <p>Aucun produit </p>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-clipboard-list fa-2x text-gray-300"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pending Requests Card Example -->
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card border-left-warning  h-100 py-2">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                    Total Achat</div>
                                <div class="h5 mb-0 font-weight-bold text-gray-800">{{ totalDesAchats|number_format(2, ',', ' ') }} Ar</div>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-comments fa-2x text-gray-300"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">

            <!-- Earnings (Monthly) Card Example -->
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card border-left-primary  h-100 py-2">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                    Nombre client</div>
                                <div class="h5 mb-0 font-weight-bold text-gray-800">
                                    6
                                </div>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-user fa-2x text-gray-300"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Earnings (Monthly) Card Example -->
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card border-left-danger  h-100 py-2">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-danger text-uppercase mb-1">
                                    Nombre Fournisseur</div>
                                <div class="h5 mb-0 font-weight-bold text-gray-800">
                                    3
                                </div>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-truck fa-2x text-gray-300"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Earnings (Monthly) Card Example -->
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card border-left-dark  h-100 py-2">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-dark text-secondary text-uppercase mb-1">Nombre Utilisateur
                                </div>
                                <div class="row no-gutters align-items-center">
                                    <div class="col-auto">
                                        <div class="h5 mb-0 mr-3 font-weight-bold text-gray-800">
                                            5
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-clipboard-list fa-2x text-gray-300"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pending Requests Card Example -->
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card border-left-secondary  h-100 py-2">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-secondary text-uppercase mb-1">
                                    Total Vente</div>
                                <div class="h5 mb-0 font-weight-bold text-gray-800">{{ totalDesVentes|number_format(2, ',', ' ') }} Ar</div>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-shopping-cart fa-2x text-gray-300"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
<!-- Content Row -->
    <div class="row">
        <!-- Content Column -->
        <div class="col-lg-6 mb-4">
            <!-- Project Card Example -->
            <div class="card  mb-4">
            <div class="text-xs font-weight-bold text-secondary text-uppercase m-2">
                                    Statistique Achat & Vente</div>
                <div class="card-body">
                
                    <canvas id="monthlyStatisticsChart" width="400" height="200"></canvas>
                    
                    <select id="yearSelector" class="form-select form-select-sm mt-2">
                        {% for year in 2021..2060 %}
                            <option value="{{ year }}">{{ year }}</option>
                        {% endfor %}
                    </select>

                    <script>
    async function fetchMonthlyStatistics(year) {
        const response = await fetch(`/api/monthly-statistics?year=${year}`);
        const data = await response.json();
        return data;
    }

    function getMonthLabels(year) {
        const months = [];
        for (let month = 1; month <= 12; month++) {
            months.push(new Date(year, month - 1).toLocaleString('default', { month: 'long' }));
        }
        return months;
    }

    async function createChart(year) {
        const statistics = await fetchMonthlyStatistics(year);
        const salesData = Object.values(statistics.sales);
        const purchaseData = Object.values(statistics.purchases);

        // Ajouter 'MGA' aux valeurs des données
        const salesDataWithCurrency = salesData.map(value => `${value} MGA`);
        const purchaseDataWithCurrency = purchaseData.map(value => `${value} MGA`);

        const ctx = document.getElementById('monthlyStatisticsChart').getContext('2d');
        const myChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: getMonthLabels(year),
                datasets: [
                    {
                        label: 'Ventes (MGA)',
                        data: salesData,
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1
                    },
                    {
                        label: 'Achats (MGA)',
                        data: purchaseData,
                        backgroundColor: 'rgba(153, 102, 255, 0.2)',
                        borderColor: 'rgba(153, 102, 255, 1)',
                        borderWidth: 1
                    }
                ]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return value + ' MGA';
                            }
                        }
                    }
                },
                tooltips: {
                    callbacks: {
                        label: function(tooltipItem, data) {
                            const dataset = data.datasets[tooltipItem.datasetIndex];
                            const datasetLabel = dataset.label || '';
                            const dataValue = dataset.data[tooltipItem.index];
                            return datasetLabel + ': ' + dataValue + ' MGA';
                        }
                    }
                }
            }
        });
    }

    document.getElementById('yearSelector').addEventListener('change', function() {
        const selectedYear = this.value;
        createChart(selectedYear);
    });

    // Initial load
    createChart(new Date().getFullYear());
</script>

                </div>
            </div> 
        </div>
        <div class="col-lg-6 mb-4">
            <!-- Project Card Example -->
            <div class="card  mb-4">
                <div class="text-xs font-weight-bold text-secondary text-uppercase m-2">
                                        Statistique Achat & Vente</div>
                    <div class="card-body">
                    
                    </div>
                </div>
            </div>
        </div>
    


                    
    
{% endblock %}
